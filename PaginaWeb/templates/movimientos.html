{% extends "base.html" %}
{% block content %}

<div class="page-header">
    <h1>Registrar Movimiento</h1>
</div>

<div class="form-card">

    <h3>Datos del Movimiento</h3>

    <form method="post" class="product-form">
        {% csrf_token %}

        <div class="form-row">

            <div class="form-group">
                <label for="producto">Producto</label>
                <select name="producto" id="producto" required>
                    <option value="">Seleccione un producto...</option>
                    {% for p in productos %}
                        <option value="{{ p.id }}" 
                                data-unidad="{{ p.unidad_base.nombre }}">
                            {{ p.codigo }} - {{ p.nombre }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="tipo">Tipo de movimiento</label>
                <select name="tipo" id="tipo" required>
                    <option value="">Seleccione tipo...</option>
                    <option value="entrada">Entrada</option>
                    <option value="salida">Salida</option>
                    <option value="merma">Merma</option>
                    <option value="ajuste">Ajuste</option>
                </select>
            </div>

        </div>


        <div class="form-row">

            <div class="form-group">
                <label id="labelCantidad">Cantidad</label>
                <input type="number" step="0.01" min="0" name="cantidad" id="cantidad" required>
                <small id="unidadTexto"></small>
            </div>

           <div class="form-group">
            <label for="proveedor">Proveedor</label>
            <select name="proveedor" id="proveedor">
                <option value="">Elige uno si es entrada</option>
                {% for pr in proveedores %}
                    <option value="{{ pr.id }}">{{ pr.nombre }}</option>
                {% endfor %}
            </select>
        </div>

        </div>


        <div class="form-row">
            <div class="form-group full-width">
                <label for="motivo">Motivo</label>
                <textarea name="motivo" id="motivo" rows="3"></textarea>
            </div>
        </div>

        <div class="form-actions">
            <a href="{% url 'movimientos_lista' %}" class="btn-secondary">Cancelar</a>
            <button type="submit" class="btn-primary">Guardar Movimiento</button>
        </div>

    </form>

    <p style="margin: 0; color: var(--muted); font-size: 1rem;">
        ¿No aparece tu proveedor o aún no lo tienes registrado?
    </p>

    <a href="{% url 'proveedor_crear' %}" class="btn-primary small"
       style="margin-top: 6px; margin-left: 120px; display: inline-block;">
        Haz Click aquí
    </a>

</div>


<script>

document.addEventListener("DOMContentLoaded", () => {

    const tipo = document.getElementById("tipo");
    const proveedor = document.getElementById("proveedor");

    function bloquearProveedor() {
        if (tipo.value === "entrada") {
            proveedor.disabled = false; // habilitar
        } else {
            proveedor.disabled = true;  // bloquear
            proveedor.value = "";       // limpiar selección
        }
    }

    tipo.addEventListener("change", bloquearProveedor);
    bloquearProveedor(); // ejecutar al inicio
});
</script>

{% endblock %}